<!DOCTYPE html>
<html>
<head>
<title>Edit Post</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>

/* ===== RESET ===== */

*{
    margin:0;
    padding:0;
    box-sizing:border-box;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
}

body{
    background:#f7f7f7;
}

/* ===== NAVBAR ===== */

.navbar{
    background:black;
    color:white;
    padding:18px 40px;
    display:flex;
    justify-content:space-between;
    align-items:center;
}

.navbar button{
    background:white;
    color:black;
    border:none;
    padding:8px 18px;
    border-radius:25px;
    cursor:pointer;
}

/* ===== CONTAINER ===== */

.container{
    max-width:700px;
    margin:auto;
    padding:60px 20px;
}

/* Title */

h1{
    font-size:36px;
    margin-bottom:35px;
}

/* Inputs */

input, textarea{
    width:100%;
    padding:16px;
    border-radius:14px;
    border:1px solid #e2e2e2;
    margin-bottom:22px;
    font-size:16px;
    outline:none;
    background:white;
}

textarea{
    height:200px;
    resize:none;
}

/* Button */

.primary-btn{
    padding:13px 30px;
    background:black;
    color:white;
    border:none;
    border-radius:30px;
    cursor:pointer;
    font-size:15px;
    transition:0.2s;
}

.primary-btn:hover{
    opacity:0.85;
}

/* Error */

.error{
    color:red;
    margin-top:15px;
}

/* Responsive */

@media(max-width:600px){
    .navbar{
        padding:15px 20px;
    }

    .container{
        padding:40px 15px;
    }

    h1{
        font-size:28px;
    }
}

</style>

</head>

<body>

<div class="navbar">
<div class="logo">BlogApp</div>

<div>
<button onclick="goHome()">Home</button>
<button onclick="logout()">Logout</button>
</div>
</div>

<div class="container">

<h1>Edit Post</h1>

<input type="text" id="title" placeholder="Post Title" />

<textarea id="content" placeholder="Post Content"></textarea>

<button class="primary-btn" id="updateBtn">Update Post</button>

<p id="error" class="error"></p>

</div>

<script>

const API_BASE="http://localhost:8080";

const params=new URLSearchParams(window.location.search);
const id=params.get("id");

function getToken(){
    return localStorage.getItem("token");
}

/* ===== AUTH CHECK ===== */

if(!getToken()){
    window.location.href="login.html";
}

function logout(){
    localStorage.removeItem("token");
    window.location.href="login.html";
}

function goHome(){
    window.location.href="index.html";
}

/* ===== LOAD POST ===== */

async function loadPost(){

    try{

        const res=await fetch(`${API_BASE}/post/${id}`);

        if(!res.ok) throw new Error();

        const post=await res.json();

        document.getElementById("title").value=post.title;
        document.getElementById("content").value=post.content;

    }catch{
        document.querySelector(".container").innerHTML=
            "<h2>Post not found.</h2>";
    }
}

loadPost();

/* ===== UPDATE POST ===== */

document.getElementById("updateBtn").addEventListener("click",async()=>{

    const token=getToken();

    const title=document.getElementById("title").value.trim();
    const content=document.getElementById("content").value.trim();

    if(!title || !content){
        document.getElementById("error").innerText="All fields are required.";
        return;
    }

    try{

        const res=await fetch(`${API_BASE}/post/${id}`,{
            method:"PUT",
            headers:{
                "Content-Type":"application/json",
                "Authorization":"Bearer "+token
            },
            body:JSON.stringify({
                title,
                content
            })
        });

        if(!res.ok) throw new Error();

        alert("Post updated successfully");
        window.location.href=`post.html?id=${id}`;

    }catch{
        document.getElementById("error").innerText=
            "Failed to update post.";
    }
});

</script>

</body>
</html>